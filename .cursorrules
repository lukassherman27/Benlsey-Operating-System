# Bensley Operations Platform - Cursor AI Rules

## Project Context
- **What**: AI-powered operations dashboard for Bensley Design Studios
- **Tech**: Next.js 15.1.3 + FastAPI + SQLite
- **Status**: Phase 1 Week 4 (85% complete, operational)
- **Frontend**: http://localhost:3002
- **Backend**: http://localhost:8000

## Your Focus: Frontend Development Only
You are responsible for frontend components in `frontend/src/` directory.
Backend API and database work is handled separately by Claude Code.

## Tech Stack (Frontend)
- Next.js 15.1.3 with App Router
- TypeScript (strict mode)
- shadcn/ui components (40+ installed)
- TanStack Query (React Query v5)
- Tailwind CSS
- Recharts for data visualization

## Key Patterns to Follow

### 1. Server vs Client Components
```typescript
// Client component (needs "use client" for interactivity)
"use client";
import { useState } from "react";

// Use Client Components for:
// - React hooks (useState, useEffect, useQuery)
// - Event handlers
// - Interactive UI
```

### 2. React Query Pattern
```typescript
import { useQuery } from "@tanstack/react-query";
import { getFinancialMetrics } from "@/lib/api";

const { data, isLoading } = useQuery({
  queryKey: ["financial-metrics"],
  queryFn: getFinancialMetrics,
});
```

### 3. API Integration
- API client is in `frontend/src/lib/api.ts`
- Types are in `frontend/src/lib/types.ts`
- Backend base URL: http://localhost:8000
- Always add new API functions to api.ts
- Always add new types to types.ts

### 4. State Management - CRITICAL
```typescript
// ❌ NEVER do this (causes infinite re-renders)
if (data) {
  setFormData(data);
}

// ✅ ALWAYS use useEffect
useEffect(() => {
  if (data) {
    setFormData(data);
  }
}, [data?.id]);
```

### 5. shadcn/ui Components
Already installed: button, dialog, select, table, card, input, form, badge, separator, etc.

Import from `@/components/ui/`:
```typescript
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader } from "@/components/ui/card";
```

## File Structure
```
frontend/src/
├── app/(dashboard)/
│   ├── page.tsx                 # Main dashboard
│   ├── tracker/page.tsx         # Proposal tracker (✅ done)
│   └── projects/page.tsx        # Active projects (in progress)
├── components/
│   ├── ui/                      # shadcn components
│   ├── dashboard/               # Dashboard widgets
│   └── proposals/               # Proposal components
└── lib/
    ├── api.ts                   # API client
    ├── types.ts                 # TypeScript types
    └── utils.ts                 # Utilities (cn, formatters)
```

## Available Backend Endpoints
See http://localhost:8000/docs for full API documentation.

**Financial APIs:**
- GET /api/financial/metrics - Dashboard metrics
- GET /api/invoices - List invoices
- GET /api/invoices/{id} - Get invoice details

**Proposals:**
- GET /api/proposals - List all proposals
- GET /api/proposals/{code} - Get single proposal
- PUT /api/proposals/{code} - Update proposal

## Code Style
- Use TypeScript strict mode (no any types)
- Use Tailwind CSS for styling
- Prefer shadcn/ui components over custom UI
- Use `cn()` utility for conditional classes
- Format currency: `formatCurrency()` from `@/lib/utils.ts`
- Format dates: `format()` from `date-fns`

## Important Rules
1. **Frontend only**: Don't modify backend, database, or Python files
2. **Commit often**: Commit your changes frequently so Claude Code can see them
3. **Test locally**: Always test at http://localhost:3002 before committing
4. **Read docs**: Check FRONTEND_GUIDE.md for detailed patterns
5. **Type safety**: Always define TypeScript interfaces for new data structures

## Current Priority Tasks
1. Financial dashboard widgets (invoice aging, cash flow forecast)
2. Complete Active Projects page
3. Add data visualizations with Recharts

## Resources
- Frontend Guide: `FRONTEND_GUIDE.md`
- Current Status: `CURRENT_STATUS.md`
- API Docs: http://localhost:8000/docs
- Next.js Docs: https://nextjs.org/docs
- shadcn/ui: https://ui.shadcn.com

## When You're Stuck
- Check existing patterns in `frontend/src/components/proposals/`
- Review `FRONTEND_GUIDE.md` for troubleshooting
- Look at `frontend/src/lib/api.ts` for API call examples
- Check `frontend/src/lib/types.ts` for available types

## Coordination with Claude Code
- You: Frontend components and pages
- Claude Code: Backend APIs, database migrations, system tasks
- User: Bridges context between both AIs via git commits
